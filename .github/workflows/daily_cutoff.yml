name: Daily Absent Cutoff

on:
  schedule:
    # ตั้งเวลาทำงานถี่ขึ้น เพื่อให้แน่ใจว่าไป "กระแทก" เวลาที่ตั้งไว้ใน Setting
    # UTC (ช้ากว่าไทย 7 ชม.)
    # เวลาที่แนะนำ: รันทุก 30 นาที ตั้งแต่ 9:30 น. - 16:30 น. UTC (16:30 น. - 23:30 น. ไทย)
    
    # 02:00 UTC = 09:00 น. ไทย (รอบเช้า เพื่อความปลอดภัย)
    - cron: '0 2 * * *' 
    
    # รันทุก 30 นาที ระหว่าง 9:30 - 16:30 UTC (ช่วงเย็นถึงค่ำไทย)
    - cron: '30 9-16/1 * * *'  # 9:30, 10:30, 11:30, ..., 16:30 UTC
    - cron: '0 10-17/1 * * *'  # 10:00, 11:00, 12:00, ..., 17:00 UTC
    
  workflow_dispatch: # เพื่อให้กดรันเล่นได้ด้วย

jobs:
  cutoff:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: Install Dependencies
        run: npm install firebase-admin dayjs

      - name: Run Cutoff Script
        env:
          FIREBASE_SERVICE_ACCOUNT: ${{ secrets.FIREBASE_SERVICE_ACCOUNT }}
        run: node scripts/auto-cutoff.js